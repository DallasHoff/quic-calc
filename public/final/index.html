<!DOCTYPE html>
<html lang="en">
<head>
	<title>Area of a Circle | Quic Calc</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,viewport-fit=cover">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="Dallas Hoffman">
	<meta name="application-name" content="Quic Calc">
	<meta name="description" content="A Quick Calculator App">
	<link href="https://fonts.googleapis.com/css2?family=Varela+Round&amp;display=swap" rel="stylesheet">
</head>
<?php
$method = $_SERVER['REQUEST_METHOD'];

$calcRadius = null;
$calcResult = null;
$calcError = null;

if ($method == 'GET' && isset($_GET['radius'])) {
	$calcRadius = floatval($_GET['radius']);
	
	// Call cloud function to calculate area
	// Curl code generated from Postman
	$curl = curl_init();
	curl_setopt_array($curl, array(
		CURLOPT_URL => 'https://us-east1-dismob.cloudfunctions.net/circle-area',
		CURLOPT_RETURNTRANSFER => true,
		CURLOPT_ENCODING => '',
		CURLOPT_MAXREDIRS => 10,
		CURLOPT_TIMEOUT => 0,
		CURLOPT_FOLLOWLOCATION => true,
		CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
		CURLOPT_CUSTOMREQUEST => 'POST',
		CURLOPT_POSTFIELDS => "{
			\"radius\": $calcRadius
		}",
		CURLOPT_HTTPHEADER => array(
			'Content-Type: application/json'
		),
	));

	// Get response and close
	$cfResponse = curl_exec($curl);
	$cfResponseCode = curl_getinfo($curl, CURLINFO_HTTP_CODE);
	if ($cfResponse === false) {
		// Curl Error
		$calcError = curl_error($curl);
	} else if ($cfResponseCode !== 200) {
		// Function Error
		$calcError = $cfResponse;
	} else {
		// Success
		$calcResult = $cfResponse;
	}
	curl_close($curl);

}
?>
<body data-calc-result="<?= htmlentities($calcResult) ?>" data-calc-radius="<?= htmlentities($calcRadius) ?>" data-calc-error="<?= htmlentities($calcError) ?>">
	<!-- JavaScript not enabled message -->
	<noscript>
		<article class="error-page">
			<section class="error-card">
				<p>We're sorry, but Quic Calc doesn't work properly without JavaScript enabled.
					Please enable it to continue.</p>
				<img src="/error-icon.svg" alt="" class="error-icon">
				<a href="">Reload Page</a>
			</section>
		</article>
	</noscript>
	<!-- App mount point -->
	<div id="app"></div>
	<!-- Built files will be auto injected -->
</body>
</html>